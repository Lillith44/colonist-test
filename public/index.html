<!DOCTYPE html>
<html>
<head>
	<title>Ping Pong Game</title>
</head>
<body>
	<canvas id="canvas"></canvas>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript">
		//Sample functions, remove these functions and design ping-pong game with onInit and onUpdate.
		var canvas = document.getElementById("canvas");
		var ctx = canvas.getContext("2d");
        var canvasWidth=canvas.width;
        var canvasHeight=canvas.height;
		var player = {
			pressingS: false,
			pressingW: false,
			pressingDown: false,
			pressingup: false,
			pause: false,
		} ;

		canvas.setAttribute('width', window.innerWidth);
		canvas.setAttribute('height', window.innerHeight);

		// Remove Scrollbars: https://stackoverflow.com/questions/26745292/canvas-toggle-filling-whole-page-removing-scrollbar
		document.body.scrollTop = 0; // <-- pull the page back up to the top
        document.body.style.overflow = 'hidden'; // <-- relevant addition
		
		app.reset = function(){
			for(var index in this.nodes){
			var node = this.nodes[index];

				if(node.id === 'ball'){
					node.x=70;
					node.y= 40;
					node.angle= Math.random()*360;
				}
			}
		}

		app.onInit = function(){
			this.width = window.innerWidth;
			this.height = window.innerHeight ;

			this.nodes.push({
				id: 'player1',
				x: 40,
				y: 40,
				width : 15,
				height: 100, 
				color:'black',
				name: '1',
				score: 0,
				
			});

			this.nodes.push({
				id: 'player2',
				x: this.width - 40,
				y: 40,
				width: 15,
				height: 100,
				color: 'black',
				name:'2',
				score: 0, 
				
			});
			
			this.nodes.push({
				id: 'ball',
				x: 70,
				y: 40,
				width: 20, 
				height: 20, 
				color: 'red',
				name: 'B',
				angle: Math.random()*360,
			});
			
			
		};
		 
		testCollisionRectRect = function(rect1,rect2){
			return rect1.x <= rect2.x+rect2.width 
				&& rect2.x <= rect1.x+rect1.width
				&& rect1.y <= rect2.y + rect2.height
				&& rect2.y <= rect1.y + rect1.height;
		}
		document.onkeydown = function (event) {
			if (event.keyCode === 83)	//s
				player.pressingS = true;
			else if (event.keyCode === 87) // w
				player.pressingW = true;
			else if (event.keyCode === 38) //up
				player.pressingUp = true;
			else if (event.keyCode === 40) //down
				player.pressingDown = true;
			else if (event.keyCode === 32) //space
				player.pause = !player.pause;
		}

		document.onkeyup = function (event) {
			if (event.keyCode === 83)	//s
				player.pressingS = false;
			else if (event.keyCode === 87) // w
				player.pressingW = false;
			else if (event.keyCode === 38) //up
				player.pressingUp = false;
			else if (event.keyCode === 40) //down
				player.pressingDown = false;
		}
		app.addScore = function(player){
			for(var index in this.nodes){
			var node = this.nodes[index];

				if(node.id === player){
					node.score += 1;
				}
			}
		}
		app.onUpdate = function(time){

			if(player.pause === true){
				return
			}

			for(var index in this.nodes){
			var node = this.nodes[index];

				if(node.id === 'player1'){
					if(player.pressingS === true) {
						node.y += 1;
					} 
					if(player.pressingW === true) {
						node.y -= 1;
					}
					
				} else if (node.id === 'player2'){
					if(player.pressingUp === true) {
						node.y -= 1;
					} 
					if(player.pressingDown === true) {
						node.y += 1;
					}
				} else if (node.id === 'ball') {
					var angle = node.angle;
					
					//test for bounce at top
					if(node.y <= 0){
						angle = 360-angle;
						node.angle = angle;
					}
					//test for bounce at bottom
					if(node.y + node.height >= this.height ){
						angle = 360-angle;
						node.angle = angle;
					}
					//test for left collision
					if(node.x <= 0 ){
						app.addScore('player2')
						console.log('player2 scores')
						app.reset();

					}
					//test for right collision
					if(node.x + node.width >= this.width ){
						app.addScore('player1')
						console.log('player1 scores')
						app.reset();
					}
				
					var spdX = Math.cos(angle/180*Math.PI)*5;
					var spdY = Math.sin(angle/180*Math.PI)*5;

					node.x += spdX;
					node.y += spdY;

					



				}

			}
			
		};
	</script>
</body>
</html>